# Telegram Bot с GLM AI

Telegram бот с AI на основе GLM API (ChatGLM/ZhipuAI) для работы в каналах и группах.

## Установка

1. **Установите зависимости:**
```bash
pip install -r requirements.txt
```

2. **Настройте переменные окружения:**

Скопируйте `.env.example` в `.env`:
```bash
cp .env.example .env
```

Отредактируйте `.env` файл:
```env
TELEGRAM_BOT_TOKEN=your_bot_token_here
GLM_API_KEY=your_glm_api_key_here
GLM_API_URL=https://open.bigmodel.cn/api/paas/v4/chat/completions
GLM_MODEL=glm-4-7b
```

## Получение токенов

### Telegram Bot Token
1. Откройте [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям и получите токен

### GLM API Key
1. Зарегистрируйтесь на [ZhipuAI Platform](https://open.bigmodel.cn/)
2. Получите API key в личном кабинете

## Использование

### Запуск бота:
```bash
python bot.py
```

### В личке:
- Просто напишите сообщение боту
- Бот сохраняет историю диалога

### В группе/канале:
- Добавьте бота в группу
- Дайте права на чтение и отправку сообщений
- Упомяните бота через `@username` или ответьте на его сообщение

### Команды:
- `/start` - Начать работу
- `/help` - Показать справку
- `/clear` - Очистить историю диалога

## Настройка доступа

Чтобы бот работал только в определенных чатах, укажите их ID в `.env`:
```env
ALLOWED_CHAT_IDS=-1001234567890,-1009876543210
```

### Как узнать Chat ID:
1. Добавьте бота в группу
2. Напишите какое-нибудь сообщение
3. Временно измените код бота, чтобы он выводил `update.effective_chat.id`
4. Или используйте бота [@GetMyIdBot](https://t.me/GetMyIdBot)

## Дополнительная настройка

### Изменение системного промпта:

В файле `bot.py` измените переменную `SYSTEM_PROMPT`:
```python
SYSTEM_PROMPT = """Ты эксперт по программированию. Помогай с кодом."""
```

### Изменение модели GLM:

В `.env` файле:
```env
GLM_MODEL=glm-4-7b
```

Доступные модели:
- `glm-4-7b` - базовая модель 7B (по умолчанию)
- `glm-4` - стандартная модель
- `glm-4-plus` - улучшенная версия
- `glm-4-flash` - быстрая версия
- `glm-3-turbo` - предыдущее поколение

## Файловая структура

```
bot/
├── bot.py              # Главный файл бота
├── glm_client.py       # Клиент для GLM API
├── history_manager.py  # Управление историей диалогов
├── config.py           # Конфигурация
├── requirements.txt    # Зависимости Python
├── .env.example        # Пример переменных окружения
├── .env                # Ваши реальные данные (создайте сами)
└── README.md           # Этот файл
```

## Troubleshooting

### Бот не отвечает в группе
- Убедитесь, что бот имеет права на отправку сообщений
- Проверьте, что вы упоминаете бота через @username
- Проверьте ALLOWED_CHAT_IDS в настройках

### Ошибки GLM API
- Проверьте правильность API ключа
- Убедитесь, что у вас достаточно лимитов запросов
- Проверьте правильность URL API

## Лицензия

MIT
